version: "3.6"

# Чтобы не писать везде file: ./deploy/docker-compose.yml
# можно добавить в .env файл переменную COMPOSE_FILE=deploy/docker-compose.yml:docker-compose.yml и docker-compose файлы
# автоматически объединятся

# Лучше чтобы названия сервисов в родительском файле совпадали с названиями в дочернем файле и директива extend будет ненужна

services:
  web:
    extends:
      file: ./deploy/docker-compose.yml
      service: web-service
    depends_on:
      - database
  database:
    extends:
      file: ./deploy/docker-compose.yml
      service: database
    depends_on:
      - rabbitmq
  rabbitmq:
    extends:
      file: ./deploy/docker-compose.yml
      service: rabbitmq
  core:
    extends:
      file: ./deploy/docker-compose.yml
      service: core-service
    build:
      context: ./core-service
    volumes:
      - ./core-service:/app
    depends_on:
      - database
  auth:
    extends:
      file: ./deploy/docker-compose.yml
      service: auth-service
    build:
      context: ./auth-service
    volumes:
      - ./auth-service:/app
    depends_on:
      - core
